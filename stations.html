<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrainSafe - Bosh Sahifa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: #60d1decb;
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            height: 50px;
            margin-right: 15px;
            transition: transform 0.3s;
        }
        
        .logo:hover {
            transform: scale(1.1);
        }
        
        .status-badge.normal {
            color: #198754;
        }
        
        .status-badge.warning {
            color: #ffc107;
        }
        
        .status-badge.alarm {
            color: #dc3545;
        }
        
        .normal {
            color: #198754;
        }
        
        .warning {
            color: #ffc107;
        }
        
        .alarm {
            color: #dc3545;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .alert-icon {
            margin-right: 8px;
        }
        
        .back-btn {
            margin: 15px;
        }
        
        .lang-switcher {
            display: flex;
            gap: 5px;
            background: url('assets/lang-bg.png') no-repeat center/cover;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 3px;
            transition: background 0.3s;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .lang-btn.active {
            background: rgba(255, 255, 255, 0.6);
            font-weight: bold;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="logo-container">
            <img src="assets/railsafe.png" alt="TrainSafe Logo" class="logo">
            <img src="assets/iconr.png" alt="Partner Logo 1" class="logo">
            <img src="assets/tstu.png" alt="Partner Logo 2" class="logo">
        </div>
        <div class="d-flex align-items-center">
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="uz">UZB</button>
                <button class="lang-btn" data-lang="ru">RUS</button>
                <button class="lang-btn" data-lang="en">ENG</button>
            </div>
            <a href="profil.html" class="text-white text-decoration-none ms-3"><span class="user-icon">üë§</span> <span id="username">IRGASHEV N.N</span></a>
            <a href="note.html" class="text-white ms-4 fs-4 text-decoration-none">üîî</a>
        </div>
    </header>

    <div class="d-flex justify-content-start">
        <button class="btn btn-outline-secondary back-btn" onclick="window.location='index.html'" id="back-btn">Orqaga</button>
    </div>

    <main class="container mt-3">
        <h2 class="text-center" id="stationName">Stansiya Holati</h2>

        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="card mb-3" onclick="window.location='trains.html'" role="button" tabindex="0">
                    <div class="card-body">
                        <h5 class="card-title" id="overview-title">Umumiy Ma'lumot <span class="badge bg-info ms-auto" id="overview-badge">Batafsil</span></h5>
                        <p id="trainCount" class="mb-2">Necha poyezd keldi: <strong>Yuklanmoqda...</strong></p>
                        <p id="currentTime" class="mb-0">Joriy vaqt: <strong>Yuklanmoqda...</strong></p>
                    </div>
                </div>

                <div class="card" onclick="window.location='diaknoztika.html'" role="button" tabindex="0">
                    <div class="card-body">
                        <h5 class="card-title" id="diagnostics-title">Diaknostika Holati <span class="badge bg-warning ms-auto" id="diagnostics-badge">Yuqori</span></h5>
                        <p id="leftDevice" class="mb-2">Chap tizim holati: <strong>Yuklanmoqda...</strong></p>
                        <p id="rightDevice" class="mb-0">O'ng tizim holati: <strong>Yuklanmoqda...</strong></p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" id="chart-title">Harorat Grafigi <span class="badge bg-secondary ms-auto" id="chart-badge">Real vaqt</span></h5>
                        <div class="chart-container">
                            <canvas id="tempChart" aria-label="Train temperature chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <section class="mt-3">
            <h4 id="alerts-title">Ogohlantirishlar</h4>
            <ul id="alertList" class="list-group"></ul>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        const translations = {
            uz: {
                title: "TrainSafe - Bosh Sahifa",
                back_btn: "Orqaga",
                station_status: "{name} Holati",
                station_not_found: "Stansiya topilmadi",
                overview_title: "Umumiy Ma'lumot",
                overview_badge: "Batafsil",
                diagnostics_title: "Diaknostika Holati",
                diagnostics_badge: "Yuqori",
                chart_title: "Harorat Grafigi",
                chart_badge: "Real vaqt",
                alerts_title: "Ogohlantirishlar",
                train_count: "Necha poyezd keldi:",
                current_time: "Joriy vaqt:",
                left_device: "Chap tizim holati:",
                right_device: "O'ng tizim holati:",
                diagnostics_alert: "Diaknostika muammosi",
                alert_check: "Tekshirish",
                alert_details: "Batafsil",
                left_status_normal: "Barcha sensorlar ishlamoqda (10¬∞C)",
                right_status_warning: "Sensor #3 yuqori yuk (12¬∞C)",
                chart_label: "G'ildirak juftligi harorati (¬∞C)",
                chart_avg_label: "O'rtacha ({temp}¬∞C)",
                chart_y_axis: "Harorat (¬∞C)",
                chart_x_axis: "Poyezdlar",
                chart_aria: "Poyezdlar bo'yicha harorat grafigi",
                status_normal: "Normal",
                status_warning: "Ogohlantirish",
                status_alarm_1: "TRIVOGA-1",
                status_alarm_2: "TRIVOGA-2",
                priority_high: "Yuqori",
                priority_medium: "O'rta",
                train_alert: "Poyezd {id} ‚Äî harorat: {temp}¬∞C"
            },
            ru: {
                title: "TrainSafe - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞",
                back_btn: "–ù–∞–∑–∞–¥",
                station_status: "–°–æ—Å—Ç–æ—è–Ω–∏–µ {name}",
                station_not_found: "–°—Ç–∞–Ω—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
                overview_title: "–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                overview_badge: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
                diagnostics_title: "–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏",
                diagnostics_badge: "–í—ã—Å–æ–∫–∏–π",
                chart_title: "–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã",
                chart_badge: "–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è",
                alerts_title: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
                train_count: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–±—ã–≤—à–∏—Ö –ø–æ–µ–∑–¥–æ–≤:",
                current_time: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:",
                left_device: "–°–æ—Å—Ç–æ—è–Ω–∏–µ –ª–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:",
                right_device: "–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∞–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:",
                diagnostics_alert: "–ü—Ä–æ–±–ª–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏",
                alert_check: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å",
                alert_details: "–ü–æ–¥—Ä–æ–±–Ω–µ–µ",
                left_status_normal: "–í—Å–µ –¥–∞—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (10¬∞C)",
                right_status_warning: "–î–∞—Ç—á–∏–∫ ‚Ññ3 –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (12¬∞C)",
                chart_label: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–µ–ª—å—Å–æ–≤ (¬∞C)",
                chart_avg_label: "–°—Ä–µ–¥–Ω—è—è ({temp}¬∞C)",
                chart_y_axis: "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)",
                chart_x_axis: "–ü–æ–µ–∑–¥–∞",
                chart_aria: "–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –ø–æ–µ–∑–¥–æ–≤",
                status_normal: "–ù–æ—Ä–º–∞–ª—å–Ω–æ",
                status_warning: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ",
                status_alarm_1: "–¢–†–ï–í–û–ì–ê-1",
                status_alarm_2: "–¢–†–ï–í–û–ì–ê-2",
                priority_high: "–í—ã—Å–æ–∫–∏–π",
                priority_medium: "–°—Ä–µ–¥–Ω–∏–π",
                train_alert: "–ü–æ–µ–∑–¥ {id} ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {temp}¬∞C"
            },
            en: {
                title: "TrainSafe - Dashboard",
                back_btn: "Back",
                station_status: "{name} Status",
                station_not_found: "Station not found",
                overview_title: "Overview",
                overview_badge: "Details",
                diagnostics_title: "Diagnostics Status",
                diagnostics_badge: "High",
                chart_title: "Temperature Chart",
                chart_badge: "Real-time",
                alerts_title: "Alerts",
                train_count: "Trains Arrived:",
                current_time: "Current Time:",
                left_device: "Left System Status:",
                right_device: "Right System Status:",
                diagnostics_alert: "Diagnostics Issue",
                alert_check: "Check",
                alert_details: "Details",
                left_status_normal: "All sensors operational (10¬∞C)",
                right_status_warning: "Sensor #3 high load (12¬∞C)",
                chart_label: "Rail Temperature (¬∞C)",
                chart_avg_label: "Average ({temp}¬∞C)",
                chart_y_axis: "Temperature (¬∞C)",
                chart_x_axis: "Trains",
                chart_aria: "Train temperature chart",
                status_normal: "Normal",
                status_warning: "Warning",
                status_alarm_1: "ALARM-1",
                status_alarm_2: "ALARM-2",
                priority_high: "High",
                priority_medium: "Medium",
                train_alert: "Train {id} ‚Äî temperature: {temp}¬∞C"
            }
        };

        let currentLang = localStorage.getItem('language') || 'uz';
        let tempChart = null;

        const stations = [{
            id: "blok-post-kattakurgan",
            name: "–ë–ª–æ–∫-–ü–æ—Å—Ç-–ö–∞—Ç—Ç–∞–∫—É—Ä–≥–∞–Ω",
            coords: [39.9024, 66.2457],
            description: "Kattakurgan blok-posti, Samarqand viloyati"
        }, {
            id: "kattakurgan-rzd28",
            name: "–ö–∞—Ç—Ç–∞–∫—É—Ä–≥–∞–Ω-–†–∑–¥‚Ññ28",
            coords: [39.8800, 66.2800],
            description: "Raz'ezd N28 Kattakurgan yaqinida, Samarqand viloyati"
        }, {
            id: "nurbulak-blok-post",
            name: "–ù—É—Ä–±—É–ª–∞–∫-–ë–ª–æ–∫-–ø–æ—Å—Ç",
            coords: [39.8500, 66.4068],
            description: "Nurbulak blok-posti, Nurobod tumani"
        }, {
            id: "rzd24-nurbulak",
            name: "–†–∑–¥‚Ññ24-–ù—É—Ä–±—É–ª–∞–∫",
            coords: [39.7000, 66.8000],
            description: "Raz'ezd N24 Nurbuloq yaqinida, Pastdarg'om tumani"
        }, {
            id: "yangiyul-paxta",
            name: "–Ø–Ω–≥–∏–π—û–ª-–ü–∞—Ö—Ç–∞",
            coords: [41.0139, 68.9449],
            description: "Paxta stansiyasi (Yangiyo'l-Paxta bo'limi), Toshkent viloyati"
        }, {
            id: "paxta-almazor",
            name: "–ü–∞—Ö—Ç–∞-–ê–ª–º–∞–∑–∞—Ä",
            coords: [40.9621, 68.8583],
            description: "Almazor stansiyasi (Paxta-Almazor bo'limi), Toshkent viloyati"
        }, {
            id: "tashkent",
            name: "–¢–∞—à–∫–µ–Ω—Ç",
            coords: [41.3111, 69.2406],
            description: "Toshkent temir yo'l stansiyasi, Toshkent shahri"
        }, {
            id: "samarkand",
            name: "–°–∞–º–∞—Ä–∫–∞–Ω–¥",
            coords: [39.6825, 66.9286],
            description: "Samarqand temir yo'l stansiyasi, Samarqand viloyati"
        }, {
            id: "bukhara",
            name: "–ë—É—Ö–∞—Ä–∞",
            coords: [39.7164, 64.5511],
            description: "Buxoro temir yo'l stansiyasi, Buxoro viloyati"
        }, {
            id: "navoi",
            name: "–ù–∞–≤–æ–∏",
            coords: [40.1, 65.3667],
            description: "Navoiy temir yo'l stansiyasi, Navoiy viloyati"
        }, {
            id: "jizzak",
            name: "–î–∂–∏–∑–∞–∫",
            coords: [40.133, 67.833],
            description: "Jizzax temir yo'l stansiyasi, Jizzax viloyati"
        }, {
            id: "gulistan",
            name: "–ì—É–ª–∏—Å—Ç–∞–Ω",
            coords: [40.4915, 68.7811],
            description: "Guliston temir yo'l stansiyasi, Sirdaryo viloyati"
        }, {
            id: "kungrad",
            name: "–ö—É–Ω–≥—Ä–∞–¥",
            coords: [43.0425, 58.8503],
            description: "Kungrad temir yo'l stansiyasi, Qoraqalpog'iston Respublikasi"
        }, {
            id: "urgench",
            name: "–£—Ä–≥–µ–Ω—á",
            coords: [41.55, 60.6333],
            description: "Urganch temir yo'l stansiyasi, Xorazm viloyati"
        }, {
            id: "andijan",
            name: "–ê–Ω–¥–∏–∂–∞–Ω",
            coords: [40.7821, 72.3442],
            description: "Andijon temir yo'l stansiyasi, Andijon viloyati"
        }, {
            id: "fergana",
            name: "–§–µ—Ä–≥–∞–Ω–∞",
            coords: [40.3844, 71.7864],
            description: "Farg'ona temir yo'l stansiyasi, Farg'ona viloyati"
        }, {
            id: "termez",
            name: "–¢–µ—Ä–º–µ–∑",
            coords: [37.2611, 67.3086],
            description: "Termiz temir yo'l stansiyasi, Surxondaryo viloyati"
        }, {
            id: "karshi",
            name: "–ö–∞—Ä—à–∏",
            coords: [38.8667, 65.8],
            description: "Qarshi temir yo'l stansiyasi, Qashqadaryo viloyati"
        }, {
            id: "nukus",
            name: "–ù—É–∫—É—Å",
            coords: [42.4531, 59.6103],
            description: "Nukus temir yo'l stansiyasi, Qoraqalpog'iston Respublikasi"
        }, {
            id: "xiva",
            name: "–•–∏–≤–∞",
            coords: [41.3833, 60.35],
            description: "Xiva temir yo'l stansiyasi, Xorazm viloyati"
        }];

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
            });
            document.documentElement.lang = lang;
            document.title = translations[lang].title;
            document.getElementById('back-btn').textContent = translations[lang].back_btn;
            document.getElementById('overview-title').innerHTML = `${translations[lang].overview_title} <span class="badge bg-info ms-auto" id="overview-badge">${translations[lang].overview_badge}</span>`;
            document.getElementById('diagnostics-title').innerHTML = `${translations[lang].diagnostics_title} <span class="badge bg-warning ms-auto" id="diagnostics-badge">${translations[lang].diagnostics_badge}</span>`;
            document.getElementById('chart-title').innerHTML = `${translations[lang].chart_title} <span class="badge bg-secondary ms-auto" id="chart-badge">${translations[lang].chart_badge}</span>`;
            document.getElementById('alerts-title').textContent = translations[lang].alerts_title;
            document.getElementById('tempChart').setAttribute('aria-label', translations[lang].chart_aria);
            initializeStationPage();
        }

        function initializeStationPage() {
            const urlParams = new URLSearchParams(window.location.search);
            const stationId = urlParams.get('id');
            const station = stations.find(s => s.id === stationId);
            const stationNameElement = document.getElementById('stationName');

            if (station) {
                stationNameElement.textContent = translations[currentLang].station_status.replace('{name}', station.name);
            } else {
                stationNameElement.textContent = translations[currentLang].station_not_found;
            }

            updateDashboard();
            setInterval(updateDashboard, 30000);
        }

        function updateDashboard() {
            const mockData = {
                trainCount: 7,
                currentTime: new Date().toLocaleString(currentLang === 'uz' ? 'uz-UZ' : currentLang === 'ru' ? 'ru-RU' : 'en-US', {
                    timeZone: 'Asia/Tashkent'
                }),
                diagnostics: {
                    left: {
                        status: translations[currentLang].status_normal,
                        details: translations[currentLang].left_status_normal
                    },
                    right: {
                        status: translations[currentLang].status_warning,
                        details: translations[currentLang].right_status_warning
                    }
                },
                trains: [{
                    id: 1,
                    temp: 12,
                    status: translations[currentLang].status_alarm_1
                }, {
                    id: 2,
                    temp: 13,
                    status: translations[currentLang].status_alarm_2
                }, {
                    id: 3,
                    temp: 10,
                    status: translations[currentLang].status_normal
                }]
            };

            document.getElementById('trainCount').innerHTML = `${translations[currentLang].train_count} <strong>${mockData.trainCount}</strong>`;
            document.getElementById('currentTime').innerHTML = `${translations[currentLang].current_time} <strong>${mockData.currentTime}</strong>`;

            document.getElementById('leftDevice').innerHTML =
                `${translations[currentLang].left_device} <strong class="status-badge ${getStatusClass(mockData.diagnostics.left.status)}">${mockData.diagnostics.left.details}</strong>`;
            document.getElementById('rightDevice').innerHTML =
                `${translations[currentLang].right_device} <strong class="status-badge ${getStatusClass(mockData.diagnostics.right.status)}">${mockData.diagnostics.right.details}</strong>`;

            const alertList = document.getElementById('alertList');
            alertList.innerHTML = '';
            mockData.trains.forEach(train => {
                if (train.temp >= 10) {
                    const priority = train.temp >= 12 ? translations[currentLang].priority_high : translations[currentLang].priority_medium;
                    const icon = train.temp >= 12 ? 'üö®' : '‚ö†Ô∏è';
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `
                        <div>
                            <span class="alert-icon">${icon}</span>
                            <div class="${getTemperatureStatusClass(train.temp)} fw-bold">${train.status} (${priority})</div>
                            <div>${translations[currentLang].train_alert.replace('{id}', train.id).replace('{temp}', train.temp)}</div>
                        </div>
                        <div>
                            <small>${new Date().toLocaleTimeString(currentLang === 'uz' ? 'uz-UZ' : currentLang === 'ru' ? 'ru-RU' : 'en-US', { timeZone: 'Asia/Tashkent' })}</small>
                            <button class="btn btn-sm btn-outline-danger ms-2">${translations[currentLang].alert_check}</button>
                        </div>`;
                    alertList.appendChild(li);
                }
            });

            if (mockData.diagnostics.left.status !== translations[currentLang].status_normal || mockData.diagnostics.right.status !== translations[currentLang].status_normal) {
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `
                    <div>
                        <span class="alert-icon">üõ†Ô∏è</span>
                        <div class="warning fw-bold">${translations[currentLang].diagnostics_alert}</div>
                        <div>${translations[currentLang].left_device} ${mockData.diagnostics.left.status}, ${translations[currentLang].right_device} ${mockData.diagnostics.right.status}</div>
                    </div>
                    <div>
                        <small>${new Date().toLocaleTimeString(currentLang === 'uz' ? 'uz-UZ' : currentLang === 'ru' ? 'ru-RU' : 'en-US', { timeZone: 'Asia/Tashkent' })}</small>
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="window.location='diaknostika.html'">${translations[currentLang].alert_details}</button>
                    </div>`;
                alertList.appendChild(li);
            }

            const temps = mockData.trains.map(t => t.temp);
            const averageTemp = temps.reduce((a, b) => a + b, 0) / temps.length;
            updateTempChart(temps, averageTemp);
        }

        function updateTempChart(temps, averageTemp) {
            const ctx = document.getElementById('tempChart').getContext('2d');
            const labels = temps.map((_, index) => translations[currentLang].chart_x_axis.replace('Poyezdlar', `${translations[currentLang].chart_x_axis} ${index + 1}`));
            const pointColors = temps.map(temp =>
                temp < 10 ? 'rgba(25, 135, 84, 0.8)' :
                temp <= 12 ? 'rgba(255, 193, 7, 0.8)' :
                'rgba(220, 53, 69, 0.8)');

            if (tempChart) tempChart.destroy();

            tempChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: translations[currentLang].chart_label,
                        data: temps,
                        borderColor: '#003366',
                        backgroundColor: 'rgba(0,51,102,0.1)',
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: pointColors,
                        pointBorderColor: '#ffffff',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }, {
                        label: translations[currentLang].chart_avg_label.replace('{temp}', averageTemp.toFixed(1)),
                        data: Array(temps.length).fill(averageTemp),
                        borderColor: '#ff9800',
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: translations[currentLang].chart_y_axis,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: translations[currentLang].chart_x_axis,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    label += context.parsed.y + '¬∞C';
                                    if (context.datasetIndex === 0) {
                                        label += ` - ${getTemperatureStatusLabel(context.parsed.y)}`;
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function getTemperatureStatusClass(temp) {
            if (temp < 10) return 'normal';
            if (temp <= 12) return 'warning';
            return 'alarm';
        }

        function getTemperatureStatusLabel(temp) {
            if (temp < 10) return translations[currentLang].status_normal;
            if (temp <= 12) return translations[currentLang].status_alarm_1;
            return translations[currentLang].status_alarm_2;
        }

        function getStatusClass(status) {
            if (status === translations[currentLang].status_normal) return 'normal';
            if (status === translations[currentLang].status_warning) return 'warning';
            return 'alarm';
        }

        function initializePage() {
            setLanguage(currentLang);
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => setLanguage(btn.getAttribute('data-lang')));
            });
        }

        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>

</html>